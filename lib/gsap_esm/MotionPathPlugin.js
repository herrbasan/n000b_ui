/*!
 * MotionPathPlugin 3.2.6
 * https://greensock.com
 *
 * @license Copyright 2008-2020, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/
import{getRawPath,cacheRawPathMeasurements,getPositionOnPath,pointsToSegment,flatPointsToSegment,sliceRawPath,stringToRawPath,rawPathToString,transformRawPath,convertToPath as _convertToPath}from"./utils/paths.js";import{getGlobalMatrix}from"./utils/matrix.js";var gsap,PropTween,_getUnit,_toArray,_xProps=["x","translateX","left","marginLeft"],_yProps=["y","translateY","top","marginTop"],_DEG2RAD=Math.PI/180,_getGSAP=function(){return gsap||"undefined"!=typeof window&&(gsap=window.gsap)&&gsap.registerPlugin&&gsap},_populateSegmentFromArray=function(t,e,a,r){for(var n=e.length,o=r,i=0;i<n;i++)t[o]=parseFloat(e[i][a]),o+=2;return t},_getPropNum=function(t,e,a){return parseFloat(t._gsap.get(t,e,a||"px"))||0},_relativize=function(t){var e,a=t[0],r=t[1];for(e=2;e<t.length;e+=2)a=t[e]+=a,r=t[e+1]+=r},_segmentToRawPath=function(t,e,a,r,n,o,i){"cubic"===i.type?e=[e]:(e.unshift(_getPropNum(a,r,i.unitX),n?_getPropNum(a,n,i.unitY):0),i.relative&&_relativize(e),e=[(n?pointsToSegment:flatPointsToSegment)(e,i.curviness)]);return e=o(_align(e,a,i)),_addDimensionalPropTween(t,a,r,e,"x",i.unitX),n&&_addDimensionalPropTween(t,a,n,e,"y",i.unitY),cacheRawPathMeasurements(e,i.resolution||(0===i.curviness?20:12))},_emptyFunc=function(t){return t},_numExp=/[-+\.]*\d+[\.e\-\+]*\d*[e\-\+]*\d*/g,_originToPoint=function(t,e,a){var r,n,o,i=getGlobalMatrix(t);return"svg"===(t.tagName+"").toLowerCase()?(n=(r=t.viewBox.baseVal).x,o=r.y,r.width||(r={width:+t.getAttribute("width"),height:+t.getAttribute("height")})):(r=e&&t.getBBox&&t.getBBox(),n=o=0),e&&"auto"!==e&&(n+=e.push?e[0]*(r?r.width:t.offsetWidth||0):e.x,o+=e.push?e[1]*(r?r.height:t.offsetHeight||0):e.y),a.apply(n||o?i.apply({x:n,y:o}):{x:i.e,y:i.f})},_getAlignMatrix=function(t,e,a,r){var n,o=getGlobalMatrix(t.parentNode,!0,!0),i=o.clone().multiply(getGlobalMatrix(e)),s=_originToPoint(t,a,o),g=_originToPoint(e,r,o),p=g.x,u=g.y;return i.e=i.f=0,"auto"===r&&e.getTotalLength&&"path"===e.tagName.toLowerCase()&&(n=e.getAttribute("d").match(_numExp)||[],p+=(n=i.apply({x:+n[0],y:+n[1]})).x,u+=n.y),(n||e.getBBox&&t.getBBox)&&(p-=(n=i.apply(e.getBBox())).x,u-=n.y),i.e=p-s.x,i.f=u-s.y,i},_align=function(t,e,a){var r,n,o,i=a.align,s=a.matrix,g=a.offsetX,p=a.offsetY,u=a.alignOrigin,h=t[0][0],l=t[0][1],P=_getPropNum(e,"x"),f=_getPropNum(e,"y");return t&&t.length?(i&&("self"===i||(r=_toArray(i)[0]||e)===e?transformRawPath(t,1,0,0,1,P-h,f-l):(u&&!1!==u[2]?gsap.set(e,{transformOrigin:100*u[0]+"% "+100*u[1]+"%"}):u=[_getPropNum(e,"xPercent")/-100,_getPropNum(e,"yPercent")/-100],o=(n=_getAlignMatrix(e,r,u,"auto")).apply({x:h,y:l}),transformRawPath(t,n.a,n.b,n.c,n.d,P+n.e-(o.x-n.e),f+n.f-(o.y-n.f)))),s?transformRawPath(t,s.a,s.b,s.c,s.d,s.e,s.f):(g||p)&&transformRawPath(t,1,0,0,1,g||0,p||0),t):getRawPath("M0,0L0,0")},_addDimensionalPropTween=function(t,e,a,r,n,o){var i=e._gsap,s=i.harness,g=s&&s.aliases&&s.aliases[a],p=g&&g.indexOf(",")<0?g:a,u=t._pt=new PropTween(t._pt,e,p,0,0,_emptyFunc,0,i.set(e,p,t));u.u=_getUnit(i.get(e,p,o))||0,u.path=r,u.pp=n,t._props.push(p)},_sliceModifier=function(t,e){return function(a){return t||1!==e?sliceRawPath(a,t,e):a}};export var MotionPathPlugin={version:"3.2.6",name:"motionPath",register:function(t,e,a){_getUnit=(gsap=t).utils.getUnit,_toArray=gsap.utils.toArray,PropTween=a},init:function(t,e){if(!gsap)return!1;"object"==typeof e&&!e.style&&e.path||(e={path:e});var a,r,n,o,i=[],s=e.path,g=s[0],p=e.autoRotate,u=_sliceModifier(e.start,"end"in e?e.end:1);if(this.rawPaths=i,this.target=t,(this.rotate=p||0===p)&&(this.rOffset=parseFloat(p)||0,this.radians=!!e.useRadians,this.rProp=e.rotation||"rotation",this.rSet=t._gsap.set(t,this.rProp,this),this.ru=_getUnit(t._gsap.get(t,this.rProp))||0),Array.isArray(s)&&!("closed"in s)&&"number"!=typeof g){for(r in g)~_xProps.indexOf(r)?n=r:~_yProps.indexOf(r)&&(o=r);for(r in n&&o?i.push(_segmentToRawPath(this,_populateSegmentFromArray(_populateSegmentFromArray([],s,n,0),s,o,1),t,e.x||n,e.y||o,u,e)):n=o=0,g)r!==n&&r!==o&&i.push(_segmentToRawPath(this,_populateSegmentFromArray([],s,r,0),t,r,0,u,e))}else a=u(_align(getRawPath(e.path),t,e)),cacheRawPathMeasurements(a,e.resolution),i.push(a),_addDimensionalPropTween(this,t,e.x||"x",a,"x",e.unitX||"px"),_addDimensionalPropTween(this,t,e.y||"y",a,"y",e.unitY||"px")},render:function(t,e){var a=e.rawPaths,r=a.length,n=e._pt;for(t>1?t=1:t<0&&(t=0);r--;)getPositionOnPath(a[r],t,!r&&e.rotate,a[r]);for(;n;)n.set(n.t,n.p,n.path[n.pp]+n.u,n.d,t),n=n._next;e.rotate&&e.rSet(e.target,e.rProp,a[0].angle*(e.radians?_DEG2RAD:1)+e.rOffset+e.ru,e,t)},getLength:function(t){return cacheRawPathMeasurements(getRawPath(t)).totalLength},sliceRawPath:sliceRawPath,getRawPath:getRawPath,pointsToSegment:pointsToSegment,stringToRawPath:stringToRawPath,rawPathToString:rawPathToString,transformRawPath:transformRawPath,getGlobalMatrix:getGlobalMatrix,getPositionOnPath:getPositionOnPath,cacheRawPathMeasurements:cacheRawPathMeasurements,convertToPath:function(t,e){return _toArray(t).map((function(t){return _convertToPath(t,!1!==e)}))},convertCoordinates:function(t,e,a){var r=getGlobalMatrix(e,!0,!0).multiply(getGlobalMatrix(t));return a?r.apply(a):r},getAlignMatrix:_getAlignMatrix,getRelativePosition:function(t,e,a,r){var n=_getAlignMatrix(t,e,a,r);return{x:n.e,y:n.f}},arrayToRawPath:function(t,e){var a=_populateSegmentFromArray(_populateSegmentFromArray([],t,(e=e||{}).x||"x",0),t,e.y||"y",1);return e.relative&&_relativize(a),["cubic"===e.type?a:pointsToSegment(a,e.curviness)]}};_getGSAP()&&gsap.registerPlugin(MotionPathPlugin);export{MotionPathPlugin as default};