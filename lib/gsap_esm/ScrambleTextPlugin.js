/*!
 * ScrambleTextPlugin 3.2.6
 * https://greensock.com
 *
 * @license Copyright 2008-2020, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/
import{emojiSafeSplit,getText}from"./utils/strings.js";var gsap,_coreInitted,CharSet=function(){function e(e){this.chars=emojiSafeSplit(e),this.sets=[],this.length=50;for(var t=0;t<20;t++)this.sets[t]=_scrambleText(80,this.chars)}return e.prototype.grow=function(e){for(var t=0;t<20;t++)this.sets[t]+=_scrambleText(e-this.length,this.chars);this.length=e},e}(),_getGSAP=function(){return gsap||"undefined"!=typeof window&&(gsap=window.gsap)&&gsap.registerPlugin&&gsap},_bonusValidated=1,_spacesExp=/\s+/g,_scrambleText=function(e,t){for(var i=t.length,r="";--e>-1;)r+=t[~~(Math.random()*i)];return r},_upper="ABCDEFGHIJKLMNOPQRSTUVWXYZ",_lower=_upper.toLowerCase(),_charsLookup={upperCase:new CharSet(_upper),lowerCase:new CharSet(_lower),upperAndLowerCase:new CharSet(_upper+_lower)},_initCore=function(){_coreInitted=gsap=_getGSAP()};export var ScrambleTextPlugin={version:"3.2.6",name:"scrambleText",register:function(e,t,i){gsap=e,_initCore()},init:function(e,t,i,r,s){if(_coreInitted||_initCore(),this.prop="innerHTML"in e?"innerHTML":"textContent"in e?"textContent":0,this.prop){this.target=e,"object"!=typeof t&&(t={text:t});var a,n,l,o,p=t.text||t.value,h=!1!==t.trim,g=this;return g.delimiter=a=t.delimiter||"",g.original=emojiSafeSplit(getText(e).replace(_spacesExp," ").split("&nbsp;").join(""),a,h),"{original}"!==p&&!0!==p&&null!=p||(p=g.original.join(a)),g.text=emojiSafeSplit((p||"").replace(_spacesExp," "),a,h),g.hasClass=!(!t.newClass&&!t.oldClass),g.newClass=t.newClass,g.oldClass=t.oldClass,o=""===a,g.textHasEmoji=o&&!!g.text.emoji,g.charsHaveEmoji=!!t.chars&&!!emojiSafeSplit(t.chars).emoji,g.length=o?g.original.length:g.original.join(a).length,g.lengthDif=(o?g.text.length:g.text.join(a).length)-g.length,g.fillChar=t.fillChar||t.chars&&~t.chars.indexOf(" ")?"&nbsp;":"",g.charSet=l=_charsLookup[t.chars||"upperCase"]||new CharSet(t.chars),g.speed=.05/(t.speed||1),g.prevScrambleTime=0,g.setIndex=20*Math.random()|0,(n=g.length+Math.max(g.lengthDif,0))>l.length&&l.grow(n),g.chars=l.sets[g.setIndex],g.revealDelay=t.revealDelay||0,g.tweenLength=!1!==t.tweenLength,g.tween=i,g.rightToLeft=!!t.rightToLeft,g._props.push("scrambleText","text"),_bonusValidated}},render:function(e,t){var i,r,s,a,n,l,o,p,h,g=t.target,c=t.prop,m=t.text,S=t.delimiter,f=t.tween,u=t.prevScrambleTime,x=t.revealDelay,d=t.setIndex,_=t.chars,j=t.charSet,C=t.length,w=t.textHasEmoji,b=t.charsHaveEmoji,T=t.lengthDif,v=t.tweenLength,L=t.oldClass,P=t.newClass,E=t.rightToLeft,I=t.fillChar,D=t.speed,H=t.original,M=t.hasClass,y=m.length,A=f._time,G=A-u;x&&(f._from&&(A=f._dur-A),e=0===A?0:A<x?1e-6:A===f._dur?1:f._ease((A-x)/(f._dur-x))),e<0?e=0:e>1&&(e=1),E&&(e=1-e),i=~~(e*y+.5),e?((G>D||G<-D)&&(t.setIndex=d=(d+(19*Math.random()|0))%20,t.chars=j.sets[d],t.prevScrambleTime+=G),a=_):a=H.join(S),E?1!==e||!f._from&&"isFromStart"!==f.data?(o=m.slice(i).join(S),s=b?emojiSafeSplit(a).slice(0,C+(v?1-e*e*e:1)*T-(w?emojiSafeSplit(o):o).length+.5|0).join(""):a.substr(0,C+(v?1-e*e*e:1)*T-(w?emojiSafeSplit(o):o).length+.5|0),a=o):(s="",a=H.join(S)):(s=m.slice(0,i).join(S),r=(w?emojiSafeSplit(s):s).length,a=b?emojiSafeSplit(a).slice(r,C+(v?1-(e=1-e)*e*e*e:1)*T+.5|0).join(""):a.substr(r,C+(v?1-(e=1-e)*e*e*e:1)*T-r+.5|0)),o=M?((n=(p=E?L:P)&&0!==i)?"<span class='"+p+"'>":"")+s+(n?"</span>":"")+((l=(h=E?P:L)&&i!==y)?"<span class='"+h+"'>":"")+S+a+(l?"</span>":""):s+S+a,g[c]="&nbsp;"===I&&~o.indexOf("  ")?o.split("  ").join("&nbsp;&nbsp;"):o}};ScrambleTextPlugin.emojiSafeSplit=emojiSafeSplit,ScrambleTextPlugin.getText=getText,_getGSAP()&&gsap.registerPlugin(ScrambleTextPlugin);export{ScrambleTextPlugin as default};