/*!
 * MorphSVGPlugin 3.2.6
 * https://greensock.com
 *
 * @license Copyright 2008-2020, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/
import{getRawPath,reverseSegment,stringToRawPath,rawPathToString,convertToPath as _convertToPath}from"./utils/paths.js";var gsap,_toArray,_lastLinkedAnchor,_doc,_coreInitted,PluginClass,_getGSAP=function(){return gsap||"undefined"!=typeof window&&(gsap=window.gsap)&&gsap.registerPlugin&&gsap},_atan2=Math.atan2,_cos=Math.cos,_sin=Math.sin,_sqrt=Math.sqrt,_PI=Math.PI,_2PI=2*_PI,_angleMin=.3*_PI,_angleMax=.7*_PI,_bigNum=1e20,_numExp=/[-+=\.]*\d+[\.e\-\+]*\d*[e\-\+]*\d*/gi,_selectorExp=/(^[#\.][a-z]|[a-y][a-z])/gi,_commands=/[achlmqstvz]/gi,_log=function(t){return console&&void 0},_bonusValidated=1,_getAverageXY=function(t){var e,n=t.length,r=0,o=0;for(e=0;e<n;e++)r+=t[e++],o+=t[e];return[r/(n/2),o/(n/2)]},_getSize=function(t){var e,n,r,o=t.length,i=t[0],a=i,s=t[1],l=s;for(r=6;r<o;r+=6)(e=t[r])>i?i=e:e<a&&(a=e),(n=t[r+1])>s?s=n:n<l&&(l=n);return t.centerX=(i+a)/2,t.centerY=(s+l)/2,t.size=(i-a)*(s-l)},_getTotalSize=function(t,e){void 0===e&&(e=3);for(var n,r,o,i,a,s,l,g,h,_,p,u,c,f,d,m,P=t.length,S=t[0][0],v=S,y=t[0][1],T=y,M=1/e;--P>-1;)for(n=(a=t[P]).length,i=6;i<n;i+=6)for(h=a[i],_=a[i+1],p=a[i+2]-h,f=a[i+3]-_,u=a[i+4]-h,d=a[i+5]-_,c=a[i+6]-h,m=a[i+7]-_,s=e;--s>-1;)(r=((l=M*s)*l*c+3*(g=1-l)*(l*u+g*p))*l+h)>S?S=r:r<v&&(v=r),(o=(l*l*m+3*g*(l*d+g*f))*l+_)>y?y=o:o<T&&(T=o);return t.centerX=(S+v)/2,t.centerY=(y+T)/2,t.left=v,t.width=S-v,t.top=T,t.height=y-T,t.size=(S-v)*(y-T)},_sortByComplexity=function(t,e){return e.length-t.length},_sortBySize=function(t,e){var n=t.size||_getSize(t),r=e.size||_getSize(e);return Math.abs(r-n)<(n+r)/20?e.centerX-t.centerX||e.centerY-t.centerY:r-n},_offsetSegment=function(t,e){var n,r,o=t.slice(0),i=t.length,a=i-2;for(e|=0,n=0;n<i;n++)r=(n+e)%a,t[n++]=o[r],t[n]=o[r+1]},_getTotalMovement=function(t,e,n,r,o){var i,a,s,l,g=t.length,h=0,_=g-2;for(n*=6,a=0;a<g;a+=6)l=t[i=(a+n)%_]-(e[a]-r),s=t[i+1]-(e[a+1]-o),h+=_sqrt(s*s+l*l);return h},_getClosestShapeIndex=function(t,e,n){var r,o,i,a=t.length,s=_getAverageXY(t),l=_getAverageXY(e),g=l[0]-s[0],h=l[1]-s[1],_=_getTotalMovement(t,e,0,g,h),p=0;for(i=6;i<a;i+=6)(o=_getTotalMovement(t,e,i/6,g,h))<_&&(_=o,p=i);if(n)for(r=t.slice(0),reverseSegment(r),i=6;i<a;i+=6)(o=_getTotalMovement(r,e,i/6,g,h))<_&&(_=o,p=-i);return p/6},_getClosestAnchor=function(t,e,n){for(var r,o,i,a,s,l,g=t.length,h=_bigNum,_=0,p=0;--g>-1;)for(l=(r=t[g]).length,s=0;s<l;s+=6)o=r[s]-e,i=r[s+1]-n,(a=_sqrt(o*o+i*i))<h&&(h=a,_=r[s],p=r[s+1]);return[_,p]},_getClosestSegment=function(t,e,n,r,o,i){var a,s,l,g,h=e.length,_=0,p=Math.min(t.size||_getSize(t),e[n].size||_getSize(e[n]))*r,u=_bigNum,c=t.centerX+o,f=t.centerY+i;for(a=n;a<h&&!((e[a].size||_getSize(e[a]))<p);a++)s=e[a].centerX-c,l=e[a].centerY-f,(g=_sqrt(s*s+l*l))<u&&(_=a,u=g);return g=e[_],e.splice(_,1),g},_subdivideSegmentQty=function(t,e){var n,r,o,i,a,s,l,g,h,_,p,u,c,f,d=0,m=t.length,P=e/((m-2)/6);for(c=2;c<m;c+=6)for(d+=P;d>.999999;)n=t[c-2],r=t[c-1],o=t[c],i=t[c+1],a=t[c+2],s=t[c+3],l=t[c+4],g=t[c+5],h=n+(o-n)*(f=1/((Math.floor(d)||1)+1)),h+=((p=o+(a-o)*f)-h)*f,p+=(a+(l-a)*f-p)*f,_=r+(i-r)*f,_+=((u=i+(s-i)*f)-_)*f,u+=(s+(g-s)*f-u)*f,t.splice(c,4,n+(o-n)*f,r+(i-r)*f,h,_,h+(p-h)*f,_+(u-_)*f,p,u,a+(l-a)*f,s+(g-s)*f),c+=6,m+=6,d--;return t},_equalizeSegmentQuantity=function(t,e,n,r,o){var i,a,s,l,g,h,_,p=e.length-t.length,u=p>0?e:t,c=p>0?t:e,f=0,d="complexity"===r?_sortByComplexity:_sortBySize,m="position"===r?0:"number"==typeof r?r:.8,P=c.length,S="object"==typeof n&&n.push?n.slice(0):[n],v="reverse"===S[0]||S[0]<0,y="log"===n;if(c[0]){if(u.length>1&&(t.sort(d),e.sort(d),u.size||_getTotalSize(u),c.size||_getTotalSize(c),h=u.centerX-c.centerX,_=u.centerY-c.centerY,d===_sortBySize))for(P=0;P<c.length;P++)u.splice(P,0,_getClosestSegment(c[P],u,P,m,h,_));if(p)for(p<0&&(p=-p),u[0].length>c[0].length&&_subdivideSegmentQty(c[0],(u[0].length-c[0].length)/6|0),P=c.length;f<p;)u[P].size||_getSize(u[P]),l=(s=_getClosestAnchor(c,u[P].centerX,u[P].centerY))[0],g=s[1],c[P++]=[l,g,l,g,l,g,l,g],c.totalPoints+=8,f++;for(P=0;P<t.length;P++)i=e[P],a=t[P],(p=i.length-a.length)<0?_subdivideSegmentQty(i,-p/6|0):p>0&&_subdivideSegmentQty(a,p/6|0),v&&!1!==o&&!a.reversed&&reverseSegment(a),(n=S[P]||0===S[P]?S[P]:"auto")&&(a.closed||Math.abs(a[0]-a[a.length-2])<.5&&Math.abs(a[1]-a[a.length-1])<.5?"auto"===n||"log"===n?(S[P]=n=_getClosestShapeIndex(a,i,!P||!1===o),n<0&&(v=!0,reverseSegment(a),n=-n),_offsetSegment(a,6*n)):"reverse"!==n&&(P&&n<0&&reverseSegment(a),_offsetSegment(a,6*(n<0?-n:n))):!v&&("auto"===n&&Math.abs(i[0]-a[0])+Math.abs(i[1]-a[1])+Math.abs(i[i.length-2]-a[a.length-2])+Math.abs(i[i.length-1]-a[a.length-1])>Math.abs(i[0]-a[a.length-2])+Math.abs(i[1]-a[a.length-1])+Math.abs(i[i.length-2]-a[0])+Math.abs(i[i.length-1]-a[1])||n%2)?(reverseSegment(a),S[P]=-1,v=!0):"auto"===n?S[P]=0:"reverse"===n&&(S[P]=-1),a.closed!==i.closed&&(a.closed=i.closed=!1));return y&&_log("shapeIndex:["+S.join(",")+"]"),t.shapeIndex=S,S}},_pathFilter=function(t,e,n,r,o){var i=stringToRawPath(t[0]),a=stringToRawPath(t[1]);_equalizeSegmentQuantity(i,a,e||0===e?e:"auto",n,o)&&(t[0]=rawPathToString(i),t[1]=rawPathToString(a),"log"!==r&&!0!==r||_log('precompile:["'+t[0]+'","'+t[1]+'"]'))},_offsetPoints=function(t,e){if(!e)return t;var n,r,o,i=t.match(_numExp)||[],a=i.length,s="";for("reverse"===e?(r=a-1,n=-2):(r=(2*(parseInt(e,10)||0)+1+100*a)%a,n=2),o=0;o<a;o+=2)s+=i[r-1]+","+i[r]+" ",r=(r+n)%a;return s},_equalizePointQuantity=function(t,e){var n,r,o,i,a,s,l,g=0,h=parseFloat(t[0]),_=parseFloat(t[1]),p=h+","+_+" ",u=.999999;for(n=.5*e/(.5*(o=t.length)-1),r=0;r<o-2;r+=2){if(g+=n,s=parseFloat(t[r+2]),l=parseFloat(t[r+3]),g>u)for(a=1/(Math.floor(g)+1),i=1;g>u;)p+=(h+(s-h)*a*i).toFixed(2)+","+(_+(l-_)*a*i).toFixed(2)+" ",g--,i++;p+=s+","+l+" ",h=s,_=l}return p},_pointsFilter=function(t){var e=t[0].match(_numExp)||[],n=t[1].match(_numExp)||[],r=n.length-e.length;r>0?t[0]=_equalizePointQuantity(e,r):t[1]=_equalizePointQuantity(n,-r)},_buildPointsFilter=function(t){return isNaN(t)?_pointsFilter:function(e){_pointsFilter(e),e[1]=_offsetPoints(e[1],parseInt(t,10))}},_parseShape=function(t,e,n){var r,o;return(!("string"==typeof t)||_selectorExp.test(t)||(t.match(_numExp)||[]).length<3)&&((r=_toArray(t)[0])?(o=(r.nodeName+"").toUpperCase(),e&&"PATH"!==o&&(r=_convertToPath(r,!1),o="PATH"),t=r.getAttribute("PATH"===o?"d":"points")||"",r===n&&(t=r.getAttributeNS(null,"data-original")||t)):(_log("WARNING: invalid morph to: "+t),t=!1)),t},_populateSmoothData=function(t,e){for(var n,r,o,i,a,s,l,g,h,_,p,u,c=t.length,f=.2*(e||1);--c>-1;){for(p=(r=t[c]).isSmooth=r.isSmooth||[0,0,0,0],u=r.smoothData=r.smoothData||[0,0,0,0],p.length=4,g=r.length-2,l=6;l<g;l+=6)o=r[l]-r[l-2],i=r[l+1]-r[l-1],a=r[l+2]-r[l],s=r[l+3]-r[l+1],h=_atan2(i,o),_=_atan2(s,a),(n=Math.abs(h-_)<f)&&(u[l-2]=h,u[l+2]=_,u[l-1]=_sqrt(o*o+i*i),u[l+3]=_sqrt(a*a+s*s)),p.push(n,n,0,0,n,n);r[g]===r[0]&&r[g+1]===r[1]&&(o=r[0]-r[g-2],i=r[1]-r[g-1],a=r[2]-r[0],s=r[3]-r[1],h=_atan2(i,o),_=_atan2(s,a),Math.abs(h-_)<f&&(u[g-2]=h,u[2]=_,u[g-1]=_sqrt(o*o+i*i),u[3]=_sqrt(a*a+s*s),p[g-2]=p[g-1]=!0))}return t},_parseOriginFactors=function(t){var e=t.trim().split(" ");return{x:(~t.indexOf("left")?0:~t.indexOf("right")?100:isNaN(parseFloat(e[0]))?50:parseFloat(e[0]))/100,y:(~t.indexOf("top")?0:~t.indexOf("bottom")?100:isNaN(parseFloat(e[1]))?50:parseFloat(e[1]))/100}},_shortAngle=function(t){return t!==t%_PI?t+(t<0?_2PI:-_2PI):t},_morphMessage="Use MorphSVGPlugin.convertToPath() to convert to a path before morphing.",_tweenRotation=function(t,e,n,r){var o,i,a=this._origin,s=this._eOrigin,l=t[n]-a.x,g=t[n+1]-a.y,h=_sqrt(l*l+g*g),_=_atan2(g,l);return l=e[n]-s.x,g=e[n+1]-s.y,o=_atan2(g,l)-_,i=_shortAngle(o),!r&&_lastLinkedAnchor&&Math.abs(i+_lastLinkedAnchor.ca)<_angleMin&&(r=_lastLinkedAnchor),this._anchorPT=_lastLinkedAnchor={_next:this._anchorPT,t:t,sa:_,ca:r&&i*r.ca<0&&Math.abs(i)>_angleMax?o:i,sl:h,cl:_sqrt(l*l+g*g)-h,i:n}},_initCore=function(t){gsap=_getGSAP(),PluginClass=PluginClass||gsap&&gsap.plugins.morphSVG,gsap&&PluginClass?(_toArray=gsap.utils.toArray,_doc=document,PluginClass.prototype._tweenRotation=_tweenRotation,_coreInitted=1):t&&_log("Please gsap.registerPlugin(MorphSVGPlugin)")};export var MorphSVGPlugin={version:"3.2.6",name:"morphSVG",register:function(t,e){gsap=t,PluginClass=e,_initCore()},init:function(t,e,n,r,o){var i,a,s,l,g,h,_,p,u,c,f,d,m,P,S,v,y,T,M,x,b,w,z=t.nodeType?window.getComputedStyle(t):{},A=z.fill+"",F=!("none"===A||"0"===(A.match(_numExp)||[])[3]||"evenodd"===z.fillRule),I=(e.origin||"50 50").split(",");if(_coreInitted||_initCore(1),g="POLYLINE"===(i=(t.nodeName+"").toUpperCase())||"POLYGON"===i,"PATH"!==i&&!g&&!e.prop)return _log("Cannot morph a <"+i+"> element. "+_morphMessage),!1;if(a="PATH"===i?"d":"points",("string"==typeof e||e.getBBox||e[0])&&(e={shape:e}),!e.prop&&"function"!=typeof t.setAttribute)return!1;if(l=_parseShape(e.shape||e.d||e.points||"","d"===a,t),g&&_commands.test(l))return _log("A <"+i+"> cannot accept path data. "+_morphMessage),!1;if(h=e.shapeIndex||0===e.shapeIndex?e.shapeIndex:"auto",_=e.map||MorphSVGPlugin.defaultMap,this._prop=e.prop,this._render=e.render||MorphSVGPlugin.defaultRender,this._apply="updateTarget"in e?e.updateTarget:MorphSVGPlugin.defaultUpdateTarget,this._rnd=Math.pow(10,isNaN(e.precision)?2:+e.precision),this._tween=n,l){if(this._target=t,y="object"==typeof e.precompile,c=this._prop?t[this._prop]:t.getAttribute(a),this._prop||t.getAttributeNS(null,"data-original")||t.setAttributeNS(null,"data-original",c),"d"===a||this._prop){if(c=stringToRawPath(y?e.precompile[0]:c),f=stringToRawPath(y?e.precompile[1]:l),!y&&!_equalizeSegmentQuantity(c,f,h,_,F))return!1;for("log"!==e.precompile&&!0!==e.precompile||_log('precompile:["'+rawPathToString(c)+'","'+rawPathToString(f)+'"]'),(b="linear"!==(e.type||MorphSVGPlugin.defaultType))&&(c=_populateSmoothData(c,e.smoothTolerance),f=_populateSmoothData(f,e.smoothTolerance),c.size||_getTotalSize(c),f.size||_getTotalSize(f),x=_parseOriginFactors(I[0]),this._origin=c.origin={x:c.left+x.x*c.width,y:c.top+x.y*c.height},I[1]&&(x=_parseOriginFactors(I[1])),this._eOrigin={x:f.left+x.x*f.width,y:f.top+x.y*f.height}),this._rawPath=t._gsRawPath=c,m=c.length;--m>-1;)for(S=c[m],v=f[m],p=S.isSmooth||[],u=v.isSmooth||[],P=S.length,_lastLinkedAnchor=0,d=0;d<P;d+=2)v[d]===S[d]&&v[d+1]===S[d+1]||(b?p[d]&&u[d]?(T=S.smoothData,M=v.smoothData,w=d+(d===P-4?7-P:5),this._controlPT={_next:this._controlPT,i:d,j:m,l1s:T[d+1],l1c:M[d+1]-T[d+1],l2s:T[w],l2c:M[w]-T[w]},s=this._tweenRotation(S,v,d+2),this._tweenRotation(S,v,d,s),this._tweenRotation(S,v,w-1,s),d+=4):this._tweenRotation(S,v,d):(s=this.add(S,d,S[d],v[d]),s=this.add(S,d+1,S[d+1],v[d+1])||s))}else s=this.add(t,"setAttribute",t.getAttribute(a)+"",l+"",r,o,0,_buildPointsFilter(h),a);b&&(this.add(this._origin,"x",this._origin.x,this._eOrigin.x),s=this.add(this._origin,"y",this._origin.y,this._eOrigin.y)),s&&(this._props.push("morphSVG"),s.end=l,s.endProp=a)}return _bonusValidated},render:function(t,e){for(var n,r,o,i,a,s,l,g,h,_,p,u,c=e._rawPath,f=e._controlPT,d=e._anchorPT,m=e._rnd,P=e._target,S=e._pt;S;)S.r(t,S.d),S=S._next;if(1===t&&e._apply)for(S=e._pt;S;)S.end&&(e._prop?P[e._prop]=S.end:P.setAttribute(S.endProp,S.end)),S=S._next;else if(c){for(;d;)a=d.sa+t*d.ca,i=d.sl+t*d.cl,d.t[d.i]=e._origin.x+_cos(a)*i,d.t[d.i+1]=e._origin.y+_sin(a)*i,d=d._next;for(r=t<.5?2*t*t:(4-2*t)*t-1;f;)u=(s=f.i)+(s===(o=c[f.j]).length-4?7-o.length:5),a=_atan2(o[u]-o[s+1],o[u-1]-o[s]),_=_sin(a),p=_cos(a),g=o[s+2],h=o[s+3],i=f.l1s+r*f.l1c,o[s]=g-p*i,o[s+1]=h-_*i,i=f.l2s+r*f.l2c,o[u-1]=g+p*i,o[u]=h+_*i,f=f._next;if(P._gsRawPath=c,e._apply){for(n=""," ",l=0;l<c.length;l++)for(i=(o=c[l]).length,n+="M"+(o[0]*m|0)/m+" "+(o[1]*m|0)/m+" C",s=2;s<i;s++)n+=(o[s]*m|0)/m+" ";e._prop?P[e._prop]=n:P.setAttribute("d",n)}}e._render&&c&&e._render.call(e._tween,c,P)},kill:function(t){this._pt=this._rawPath=0},getRawPath:getRawPath,stringToRawPath:stringToRawPath,rawPathToString:rawPathToString,pathFilter:_pathFilter,pointsFilter:_pointsFilter,getTotalSize:_getTotalSize,equalizeSegmentQuantity:_equalizeSegmentQuantity,convertToPath:function(t,e){return _toArray(t).map((function(t){return _convertToPath(t,!1!==e)}))},defaultType:"linear",defaultUpdateTarget:!0,defaultMap:"size"};_getGSAP()&&gsap.registerPlugin(MorphSVGPlugin);export{MorphSVGPlugin as default};